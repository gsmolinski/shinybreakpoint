<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="shinybreakpoint">
<title>"What about trace()?". Idea behind the package • shinybreakpoint</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="" what about trace idea behind the package>
<meta property="og:description" content="shinybreakpoint">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">shinybreakpoint</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/app-structure.html">App Structure</a>
    <a class="dropdown-item" href="../articles/filtering-by-id.html">Filtering by Id</a>
    <a class="dropdown-item" href="../articles/debugging.html">Debugging</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/gsmolinski/shinybreakpoint/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>"What about trace()?". Idea behind the package</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gsmolinski/shinybreakpoint/blob/HEAD/vignettes/what-about-trace.Rmd" class="external-link"><code>vignettes/what-about-trace.Rmd</code></a></small>
      <div class="d-none name"><code>what-about-trace.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="i--the-story">I. The Story<a class="anchor" aria-label="anchor" href="#i--the-story"></a>
</h2>
<div class="section level3">
<h3 id="the-myth">The Myth<a class="anchor" aria-label="anchor" href="#the-myth"></a>
</h3>
<p>In his talk given at 2016 Shiny Developer Conference, Jonathan
McPherson noticed:</p>
<blockquote>
<p>If you’re a seasoned R programmer, you may have used the
<code><a href="https://rdrr.io/r/base/trace.html" class="external-link">trace()</a></code> function to add tracing without modifying your
script. Unfortunately, it’s not possible to use this utility (or any
that depend on it, such as <code>setBreakpoint</code>) with Shiny.
<code><a href="https://rdrr.io/r/base/trace.html" class="external-link">trace()</a></code> works by rewriting the body of the function to be
traced, so the function must already exist when you run it. Shiny
generates functions at runtime that aren’t easily addressable.</p>
</blockquote>
<p>It was a fragment titled “What about trace()?” and is now available
as a official documentation for Shiny<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://shiny.rstudio.com/articles/debugging.html" class="external-link"&gt;Debugging Shiny
applications&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a>. And we could say it is somehow
<em>suspicious</em>, since in the same paragraph it is said that
something is impossible, because some other thing is not <em>easily</em>
addressable, but not - as we could expect - <em>impossible</em> to be
addressable. It’s a good paragraph to start with, even that by saying
that everything started, because of this suspicion, would be nothing
more than founding myth.</p>
</div>
<div class="section level3">
<h3 id="where-are-you-objects">Where Are You, Objects?<a class="anchor" aria-label="anchor" href="#where-are-you-objects"></a>
</h3>
<p>Our aim will be the modification of the body of function to insert
<code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> there, but at first we need to find all
functions. We can do this using
<code>lapply(rlang::env_parents(rlang::current_env()), names)</code> in
the example below:</p>
<p><strong>app.R</strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="fu">modUI</span><span class="op">(</span><span class="st">"mod"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/textOutput.html" class="external-link">textOutput</a></span><span class="op">(</span><span class="st">"env"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">modServer</span><span class="op">(</span><span class="st">"mod"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/renderPrint.html" class="external-link">renderPrint</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/env_parent.html" class="external-link">env_parents</a></span><span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/stack.html" class="external-link">current_env</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="va">names</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
<p><strong>R/mod.R</strong></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modUI</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/NS.html" class="external-link">NS</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"num"</span><span class="op">)</span>, <span class="st">"Num"</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">modServer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/moduleServer.html" class="external-link">moduleServer</a></span><span class="op">(</span></span>
<span>    <span class="va">id</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The code above iterates over the environments, starting from the
current environment, and move through the parent environments,
displaying objects and environments as well.</p>
<p>By running this, we will learn that the structure of objects in the
Shiny app have the following characteristic:</p>
<ul>
<li>on the top (or: as the parent) is <code>global</code> environment,
but in our example it doesn’t contain any objects created by us</li>
<li>next, going from the top to the bottom (i.e. to the first child) we
will find the objects from our module (saved in <em>R/mod.R</em> file) -
<code>UI</code> and <code>server</code> part (but named as
<code>modUI</code> and <code>modServer</code>)</li>
<li>finally, as the grandchild we see the objects from the file where we
have started - <code>server</code> and <code>ui</code> from
<em>app.R</em> file (we can ignore the rest of the objects and
environments)</li>
<li>some environments are named (like global environment) and some of
them are not</li>
</ul>
<p>Graphically this structure looks like this:</p>
<pre><code>"global": .Random.seed
  └── "": modServer, modUI
      └── "": server, ui
          └── "": input, output, session
                                      and so on...</code></pre>
<p>This is, of course, the evidence that documentation was right:</p>
<blockquote>
<p>all R code in a Shiny app is run in the global environment or a child
of it<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://shiny.rstudio.com/articles/scoping.html" class="external-link"&gt;Scoping rules for
Shiny apps&lt;/a&gt;&lt;/p&gt;'><sup>2</sup></a></p>
</blockquote>
<p>Now, because we were able to find the objects (and our search was
very precise - we also get the environments where these objects live),
we can try to modify them.</p>
</div>
<div class="section level3">
<h3 id="and-where-are-your-elements">And Where Are Your Elements?<a class="anchor" aria-label="anchor" href="#and-where-are-your-elements"></a>
</h3>
<p>We want to modify <em>body</em> of function and we will use
<code><a href="https://rdrr.io/r/base/body.html" class="external-link">body()</a></code> for this. Not trying to be precise, but just useful
for our purposes, we can say that <code><a href="https://rdrr.io/r/base/body.html" class="external-link">body()</a></code> returns
<em>very</em> complex list (although it is not of type
<code>list</code>, but <code>language</code>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/observe.html" class="external-link">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span>    <span class="va">x</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">server</span><span class="op">)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     shiny::observe({</span></span>
<span><span class="co">#&gt;         x &lt;- 2</span></span>
<span><span class="co">#&gt;         x</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt; }</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">server</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; x &lt;- 2</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">server</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; `&lt;-`</span></span></code></pre></div>
<p>This list can be manipulated - elements can be added, removed etc. We
just need some additional functions for this, like
<code><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list()</a></code> (so we can use <code><a href="https://rdrr.io/r/base/append.html" class="external-link">append()</a></code> to add
elements to the list), <code><a href="https://rdrr.io/r/base/call.html" class="external-link">as.call()</a></code> (to turn back the list
into <code>language</code> object) or <code><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote()</a></code> to not
evaluate <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/observe.html" class="external-link">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span>    <span class="va">x</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">server</span><span class="op">)</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     x &lt;- 2</span></span>
<span><span class="co">#&gt;     x</span></span>
<span><span class="co">#&gt; }</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">server</span><span class="op">)</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">as.call</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">server</span><span class="op">)</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">server</span><span class="op">)</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     browser()</span></span>
<span><span class="co">#&gt;     x &lt;- 2</span></span>
<span><span class="co">#&gt;     x</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>now the breakpoint is set after the first element of body (and the
first element is a bracket). Let’s do the same in the complete Shiny
app:</p>
<p><strong>app.R</strong></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="fu">modUI</span><span class="op">(</span><span class="st">"mod"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/textOutput.html" class="external-link">textOutput</a></span><span class="op">(</span><span class="st">"env"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/actionButton.html" class="external-link">actionButton</a></span><span class="op">(</span><span class="st">"browser"</span>, <span class="st">"Add browser"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">modServer</span><span class="op">(</span><span class="st">"mod"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/renderPrint.html" class="external-link">renderPrint</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">mod_env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="va">modServer</span><span class="op">)</span> <span class="co"># get the environment where `modServer` is defined</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">mod_env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/observe.html" class="external-link">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">mod_env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="va">modServer</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">mod_env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">as.call</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">mod_env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/bindEvent.html" class="external-link">bindEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">browser</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
<p><strong>R/mod.R</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modUI</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/NS.html" class="external-link">NS</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"num"</span><span class="op">)</span>, <span class="st">"Num"</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">modServer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/moduleServer.html" class="external-link">moduleServer</a></span><span class="op">(</span></span>
<span>    <span class="va">id</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/observe.html" class="external-link">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">input</span><span class="op">$</span><span class="va">num</span></span>
<span>      <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We can notice that when <code>Add browser</code> button is pushed,
nothing happens. However, it is not true - <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> is
added, but we didn’t yet run the function. In other words, we have added
<code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> and have not used it yet. We can use another
example to show this clearly:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fun1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">fun1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">as.call</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">fun1</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">fun1</span><span class="op">)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     x &lt;- 2</span></span>
<span><span class="co">#&gt;     browser()</span></span>
<span><span class="co">#&gt;     x</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>How to know if <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> really works? It’s a tricky
question, because it suggests that we can know if something will be run
before actually running this. Instead of trying to answer this, let’s
just run the function: <code>fun1()</code>. We will end up in the debug
mode.</p>
<p>We can achieve the same effect in Shiny app by refreshing the session
- by hand, clicking on the refresh button in web browser or by adding
<code>getDefaultReactiveDomain()$reload()</code> to reload the session
(i.e. by using <code>reload()</code> method on session object, so it
could be also <code>session$reload()</code>):</p>
<p><strong>app.R</strong></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="fu">modUI</span><span class="op">(</span><span class="st">"mod"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/textOutput.html" class="external-link">textOutput</a></span><span class="op">(</span><span class="st">"env"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/actionButton.html" class="external-link">actionButton</a></span><span class="op">(</span><span class="st">"browser"</span>, <span class="st">"Add browser"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">modServer</span><span class="op">(</span><span class="st">"mod"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/renderPrint.html" class="external-link">renderPrint</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">mod_env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="va">modServer</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">mod_env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/observe.html" class="external-link">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">mod_env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="va">modServer</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">mod_env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">as.call</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">mod_env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/domains.html" class="external-link">getDefaultReactiveDomain</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">reload</span><span class="op">(</span><span class="op">)</span> <span class="co"># added</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/bindEvent.html" class="external-link">bindEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">browser</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
<p>Doing this, we re-run the <code>modServer()</code> function.</p>
</div>
<div class="section level3">
<h3 id="find-them-again-and-again">Find Them Again (And Again)<a class="anchor" aria-label="anchor" href="#find-them-again-and-again"></a>
</h3>
<p>Among other (not yet mentioned) problems, we still need a tools to
find <em>where</em> to insert <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code>, because until now
we have just used our eyes. This is somehow secondary issue as we mainly
would like to show in this vignette the core concept of setting
breakpoint, even if <em>by hand</em>, so solutions below are rather only
signaled.</p>
<p>Having a (named) function, which is in a saved file (which was
<code><a href="https://rdrr.io/r/base/source.html" class="external-link">source()</a></code>d, so the <code>srcref</code> attribute is
present), we can use the following functions:</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/utils/getParseData.html" class="external-link">utils::getParseData()</a></code> to get the
<code>data.frame</code> needed to reconstruct the whole script in this
saved file (<code><a href="https://rdrr.io/r/utils/getParseData.html" class="external-link">utils::getParseText()</a></code> can be useful in this
context as well)</li>
<li>
<code><a href="https://rdrr.io/r/utils/sourceutils.html" class="external-link">utils::getSrcFilename()</a></code> to get the name of the
file</li>
<li>
<code><a href="https://rdrr.io/r/utils/findLineNum.html" class="external-link">utils::findLineNum()</a></code> to get the (1) name of the object;
(2) environment where this object lives; (3) location in the body of
this object based on line number in the script (i.e. which indices to
use to get the right location when using <code>body()[[]]</code>)</li>
</ul>
<p>However, we quickly find out that after modifying the body of
function, we broke it up - <code><a href="https://rdrr.io/r/utils/findLineNum.html" class="external-link">utils::findLineNum()</a></code> no longer
returns the correct indices (<code>at</code> element of returned list is
broken):</p>
<p><strong>app.R</strong></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="fu">modUI</span><span class="op">(</span><span class="st">"mod"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/textOutput.html" class="external-link">textOutput</a></span><span class="op">(</span><span class="st">"env"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/actionButton.html" class="external-link">actionButton</a></span><span class="op">(</span><span class="st">"browser"</span>, <span class="st">"Add browser"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">modServer</span><span class="op">(</span><span class="st">"mod"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/renderPrint.html" class="external-link">renderPrint</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/findLineNum.html" class="external-link">findLineNum</a></span><span class="op">(</span><span class="st">"R/mod.R"</span>, <span class="fl">13</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">at</span> <span class="co"># check how this changed after the first use of button 'Add browser'</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/observe.html" class="external-link">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">mod_env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="va">modServer</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">mod_env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">as.call</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">mod_env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/domains.html" class="external-link">getDefaultReactiveDomain</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">reload</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/bindEvent.html" class="external-link">bindEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">browser</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
<p><strong>R/mod.R</strong></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modUI</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/NS.html" class="external-link">NS</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"num"</span><span class="op">)</span>, <span class="st">"Num"</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">modServer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/moduleServer.html" class="external-link">moduleServer</a></span><span class="op">(</span></span>
<span>    <span class="va">id</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/observe.html" class="external-link">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">input</span><span class="op">$</span><span class="va">num</span></span>
<span>      <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In the example above, we display the <code>at</code> element of
returned list - when the <code>Add browser</code> button is pushed by
the first time (and after that the debug mode is closed by pressing
<code>c</code> or <code>f</code>), we can see that the displayed indices
changed and we no longer can use this element to find the correct
location in the body of function. In other words, our code now works
just one time - after the first use, the app should be closed and run
again (if <code>at</code> would be use to determine the location of
body, of course; in the example above we are still using hard-coded
location). To resolve this problem, we need to retrieve the original
body of object (function) - one way to do this would be to use
<code><a href="https://rdrr.io/r/base/parse.html" class="external-link">parse()</a></code>. We already know the name of file (and full path as
well) from which comes the function, so it is possible to parse the file
and assign the original body of function to the broken one, before the
<code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> is added.</p>
</div>
<div class="section level3">
<h3 id="and-forget-them">And Forget Them<a class="anchor" aria-label="anchor" href="#and-forget-them"></a>
</h3>
<p>All of our actions taken until now led us to the state of greed; we
find objects, modify them and never undo the changes; and then we modify
them again, again, adding more <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code>s. This can be seen
in our previous example - each time the <code>Add browser</code> button
is pushed, next <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> is added at the top of the
previous one. Now this greed leads us into trouble:</p>
<ul>
<li>we need to escape (using <code>c</code> or <code>f</code>) from
debug mode multiple times before we escape for real - each
<code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> nests us into debug mode</li>
<li>but what is much worse - the <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> persists and
each time the <code><a href="https://shiny.rstudio.com/reference/shiny/latest/observe.html" class="external-link">observe()</a></code> runs (and it runs every time the
<code>input$num</code> changes), we end up in the debug mode</li>
</ul>
<p>The remedy for this would be to remove the <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code>
after each use, i.e. after pressing <code>c</code> or <code>f</code>
(after closing) in the debug mode. But it must be done <em>within</em>
the function which is debugged (because of the session reload). In other
words, the function will remove its own elements. Here is an
exemplification of this mechanism:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fun2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fl">2</span></span>
<span>  <span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="va">fun2</span><span class="op">)</span> <span class="co"># get the environment where `fun2` is defined</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">env</span><span class="op">$</span><span class="va">fun2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">env</span><span class="op">$</span><span class="va">fun2</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">fun2</span><span class="op">)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     2</span></span>
<span><span class="co">#&gt;     env &lt;- environment(fun2)</span></span>
<span><span class="co">#&gt;     body(env$fun2) &lt;- body(env$fun2)[-c(3, 4)]</span></span>
<span><span class="co">#&gt; }</span></span>
<span></span>
<span><span class="fu">fun2</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">fun2</span><span class="op">)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     2</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>We can see above how to include the code which removes itself; this
code can be added to the function using other function as well (in the
example above we have just added it at the beginning, by hand). In case
of Shiny app, we need to remember that another session reload will be
necessary as an equivalent of function call (equivalent of
<code>fun2()</code>). Below is an example of Shiny app with a one-time
breakpoint.</p>
<p><strong>app.R</strong></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="fu">modUI</span><span class="op">(</span><span class="st">"mod"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/actionButton.html" class="external-link">actionButton</a></span><span class="op">(</span><span class="st">"browser"</span>, <span class="st">"Add browser"</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">modServer</span><span class="op">(</span><span class="st">"mod"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/observe.html" class="external-link">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">mod_env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="va">modServer</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">mod_env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">as.call</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">mod_env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">mod_env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">as.call</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">mod_env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="va">modServer</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">mod_env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">as.call</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">mod_env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">mod_env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">as.call</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">mod_env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/domains.html" class="external-link">getDefaultReactiveDomain</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">reload</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/domains.html" class="external-link">getDefaultReactiveDomain</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">reload</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/bindEvent.html" class="external-link">bindEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">browser</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
<p><strong>R/mod.R</strong></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modUI</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/NS.html" class="external-link">NS</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">"num"</span><span class="op">)</span>, <span class="st">"Num"</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">modServer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/moduleServer.html" class="external-link">moduleServer</a></span><span class="op">(</span></span>
<span>    <span class="va">id</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/observe.html" class="external-link">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">input</span><span class="op">$</span><span class="va">num</span></span>
<span>      <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This example looks quite complex now, so it may be useful to describe
(even if repeating something) crucial steps:</p>
<ul>
<li>
<code>mod_env &lt;- environment(modServer)</code> - we are just
getting the environment where <code>modServer()</code> function is
defined - it will be later explained, why we use this</li>
<li>
<code>body(mod_env$modServer)[[2]][[3]][[3]][[2]][[2]] &lt;- as.call(append(as.list(body(mod_env$modServer)[[2]][[3]][[3]][[2]][[2]]), quote(browser()), 1))</code>
- browser is added</li>
<li>
<code>body(mod_env$modServer)[[2]][[3]][[3]][[2]][[2]] &lt;- as.call(append(as.list(body(mod_env$modServer)[[2]][[3]][[3]][[2]][[2]]), quote(env &lt;- environment(modServer)), 2))</code>
- to the function we are adding the code responsible to get the
environment where this function is defined (i.e. function in which we
are setting the breakpoint)</li>
<li>
<code>body(mod_env$modServer)[[2]][[3]][[3]][[2]][[2]] &lt;- as.call(append(as.list(body(mod_env$modServer)[[2]][[3]][[3]][[2]][[2]]), quote(body(env$modServer)[[2]][[3]][[3]][[2]][[2]] &lt;- body(env$modServer)[[2]][[3]][[3]][[2]][[2]][-c(2, 3, 4, 5)]), 3))</code>
- we are adding to the function the code responsible to remove the added
code from the function</li>
<li>
<code>body(mod_env$modServer)[[2]][[3]][[3]][[2]][[2]] &lt;- as.call(append(as.list(body(mod_env$modServer)[[2]][[3]][[3]][[2]][[2]]), quote(getDefaultReactiveDomain()$reload()), 4))</code>
- we are adding the session reload to the function (session will be
refreshed after closing debug mode)</li>
<li>
<code>getDefaultReactiveDomain()$reload()</code> - we are reloading
the session (after breakpoint is set)</li>
</ul>
<p>The very interesting and useful thing is that the line of code can
remove the <em>next</em> line of code, but at the same time this next
line of code can still be executed - we are using this to reload the
session <em>after</em> the added code was removed <em>and</em> to remove
the code responsible for this reload. Perhaps it will be clearer to see
it, taking as an example regular function:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fun2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fl">2</span></span>
<span>  <span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="va">fun2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">env</span><span class="op">$</span><span class="va">fun2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">env</span><span class="op">$</span><span class="va">fun2</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="st">"two"</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">fun2</span><span class="op">)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     2</span></span>
<span><span class="co">#&gt;     env &lt;- environment(fun2)</span></span>
<span><span class="co">#&gt;     body(env$fun2) &lt;- body(env$fun2)[-c(3, 4, 5)]</span></span>
<span><span class="co">#&gt;     "two"</span></span>
<span><span class="co">#&gt; }</span></span>
<span></span>
<span><span class="fu">fun2</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "two"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">fun2</span><span class="op">)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     2</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>When we run the function <code>fun2</code> first time, the last
element (string <code>"two"</code>), which we are removing, is returned,
so when run first time, the function will execute all lines of code, but
after this we can check that the body has changed and if we would run
the function again, only the number <code>2</code> would be returned.
This is very important, because it means that we can add the session
reload to the function and this session reload will be run (so the
changes can be applied) and then removed from the function.</p>
<p>It should be noted here, that even if it looks like we are retrieving
the original body of function (because added elements has been removed),
this is not an answer for the (mentioned earlier) problem with element
<code>at</code> in list returned by <code><a href="https://rdrr.io/r/utils/findLineNum.html" class="external-link">utils::findLineNum()</a></code>
function - <code>at</code> will still contain the wrong indices.</p>
</div>
<div class="section level3">
<h3 id="where-are-you-objects-1">“Where Are You, Objects?”<a class="anchor" aria-label="anchor" href="#where-are-you-objects-1"></a>
</h3>
<p>There is one last thing to talk about - getting the (right)
environment. In all examples of Shiny app presented until now, we have
used <code><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment()</a></code> to get the environment of object
(function), but we have did it also in the example of regular function
to remove (within the function) elements of this function. These
examples personify two aspects important for us- why it is necessary to
get the environment where object is defined and why it is necessary to
be precise.</p>
<p>The code below should help us answer, why we need the
environment:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">fun2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">fun2</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">a</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">fun2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">env</span> <span class="op">&lt;-</span> <span class="va">.GlobalEnv</span></span>
<span>  <span class="va">env</span><span class="op">$</span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">fun2</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">a</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>If we stop thinking about this problem in terms of self-referencing,
it looks simple - we can’t modify the object defined in the parent from
the child environment, because of the isolation (function closures the
environment), however we can do this if we explicitly refer to the
environment where the object if defined. Now we just need to remind
ourselves that the function is defined in different environment than
environment where exist function’s elements- is defined in the parent
environment. Thus to modify the function (from that function) we need to
refer explicitly to the environment where this function is defined -
this is not different from our example with the <code>a</code> variable
above.</p>
<p>That was the answer, why we needed to refer to the environment inside
the function, but why we needed this also in the <code>observe</code> at
the beginning, where we set the breakpoint? On the one hand, it was
indeed unnecessary - we could easily refer to the object directly, but
(on the other hand) this is not safe - what if there would be a
functions having the same name, but in different environments? How to
refer to <em>this</em> function, not <em>that</em> function?
<code><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment()</a></code> returns the environment for the
<em>nearest</em> function and it may be not enough for our purposes.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env_inner</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span><span class="va">env_outer</span> <span class="op">&lt;-</span> <span class="st">""</span></span>
<span></span>
<span><span class="va">fun3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fun3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">fun3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">env_inner</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="va">fun3</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu">fun3</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu">fun3</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">env_outer</span> <span class="op">&lt;&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="va">fun3</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">fun3</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">env_inner</span></span>
<span><span class="co">#&gt; &lt;environment: 0x0000000022e49560&gt;</span></span>
<span></span>
<span><span class="va">env_outer</span></span>
<span><span class="co">#&gt; &lt;environment: 0x0000000022e49678&gt;</span></span></code></pre></div>
<p>We see three functions, all of them have the same name and all of
them live in different environment. We already know that the function we
want to refer to is in an upper environment (because we are inside this
function), but if we are not sure if it is a direct parent, we can end
up having the reference to the wrong object, because - as already said -
<code><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment()</a></code> gives us environment for the nearest object
of chosen name.</p>
<p>In our previous examples we have used <code><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment()</a></code>, but
that was just for simplicity - we see now that it wasn’t a great idea.
<code>shinybreakpoint</code> uses something different - function which
searches through the environments to get the needed environment.</p>
<p>To be able to refer precise to given function, it is needed to know
the environment. Relatively easy would be to connect object with
environment upfront, when searching for objects across the environments
using code mentioned at the beginning,
i.e. <code>lapply(rlang::env_parents(rlang::current_env()), names)</code>.
We could at first use
<code>rlang::env_parents(rlang::current_env())</code> to get the list of
environments and then get the objects as a list, using
<code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code> and <code><a href="https://rdrr.io/r/base/names.html" class="external-link">names()</a></code>. This way we would have
two lists of the same length and every element will <em>point</em> to
the same environment, but the problem will occur when trying to use this
environment in the code added along with <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code>. Coming
back to the Shiny app, we have used this line of code before:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">mod_env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">as.call</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/body.html" class="external-link">body</a></span><span class="op">(</span><span class="va">mod_env</span><span class="op">$</span><span class="va">modServer</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="va">modServer</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We are constructing the <code>env</code> variable which is an
environment, but how to know if this is the environment which contains
<code>modServer</code> which we are looking for and not the other
function of the same name, but in the different environment (like showed
before)? So we know that it is possible to have the list of environments
and objects (functions) which belong to the given environment, but how
to use this knowledge? This solution below won’t work:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fun3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fl">3</span></span>
<span><span class="op">}</span></span>
<span><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="va">fun3</span><span class="op">)</span> <span class="co"># global environment</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">call</a></span><span class="op">(</span><span class="st">"assign"</span>, <span class="st">"envir"</span>, <span class="va">env</span><span class="op">)</span></span>
<span><span class="co">#&gt; assign("envir", &lt;environment&gt;)</span></span>
<span></span>
<span><span class="co"># assign("envir", &lt;environment&gt;)</span></span>
<span><span class="co"># Error: unexpected '&lt;' in "assign("envir", &lt;"</span></span></code></pre></div>
<p>We have constructed the call (which is an assignment), using the
variable <code>env</code> which is an environment where
<code>fun3</code> is defined, but this call is not correct - we see that
it is impossible to treat the environment like regular value - we can’t
simply evaluate the variable to get the value.</p>
<p>But the idea is not bad - we already have the object
(<code>fun3</code>) and the environment (<code>env</code>), so we could
just add to the body of function the code which will bind environment to
the name <code>envir</code>. This way we would have the correct
environment to refer to it, but as we see, instead of get something like
<code>assign("envir", .GlobalEnv)</code>, we have the incorrect syntax:
<code>assign("envir", &lt;environment&gt;)</code>. We can, however, keep
the label of environment we need and search for the correct environment
using this label. Label is the name of environment (if named) or address
in memory - to get the label, we use
<code><a href="https://rlang.r-lib.org/reference/env_name.html" class="external-link">rlang::env_label()</a></code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fun3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fl">3</span></span>
<span><span class="op">}</span></span>
<span><span class="va">env_lab</span> <span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/env_name.html" class="external-link">env_label</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="va">fun3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">get_envir</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">label</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">envirs</span> <span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/env_parent.html" class="external-link">env_parents</a></span><span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/stack.html" class="external-link">current_env</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">envirs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">envirs</span>, <span class="fu">rlang</span><span class="fu">::</span><span class="va"><a href="https://rlang.r-lib.org/reference/env_name.html" class="external-link">env_label</a></span><span class="op">)</span></span>
<span>  <span class="va">envirs</span><span class="op">[[</span><span class="va">label</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">call</a></span><span class="op">(</span><span class="st">"assign"</span>, <span class="st">"envir"</span>, <span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">call</a></span><span class="op">(</span><span class="st">"get_envir"</span>, <span class="va">env_lab</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; assign("envir", get_envir("global"))</span></span></code></pre></div>
<p>The expression <code>assign("envir", get_envir("global"))</code> can
now be added along with <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> to get the right
environment - we know that it is (in the example above)
<code>"global"</code> environment and our search (function
<code>get_envir()</code>) will give us precise environment - the labels
are unique. Of course, we still should think how to make sure that
<code>get_envir()</code> will be visible in the environment (function)
where this code will be added. In case of Shiny app it can be stored in
global environment (all objects from global environment are visible in
any environment in the app, because it is a top environment). In case of
<code>shinybreakpoint</code>, because this function lives in the
<code>{shnybreakpoint}</code> environment (namespace), access to this
function is not a problem as well (if package is installed).</p>
</div>
</div>
<div class="section level2">
<h2 id="ii--closure">II. Closure<a class="anchor" aria-label="anchor" href="#ii--closure"></a>
</h2>
<p>Setting breakpoint is a technique which is based on source code
understanding as a commands executed line-by-line. This is how the
source code is visible by humans - it is stored like a text and we all
used to read the text knowing that the next statement is on the left,
right, down. Functions make it a little more complicated - function
definition can be far, far away from the line where this function is
called, so to know, why we received the results we see, it may be
necessary to jump in the different place in the file to check the
function body (or set breakpoint). Reactive programming makes it even
more complicated - it is not so easy to know, which code block has been
executed when some input changed.</p>
<p>The idea of storing functions, grouped functions or modules in
separate files is a try to give a source code more intuitive structure
and this is a point where difference between text being a story and text
being a code becomes tangible. We could even start thinking that
affinity of <em>code</em> to the <em>text</em> is a ballast. Isn’t true
that we split source code into multiple files because we want to be able
to read it as a text (story) as easily as possible and not as a
fragmented text (story)? And don’t we feel that setting breakpoint is
now the same as selecting a text fragment in a book even if we are not
writing or reading a book? Of course, someone could say that we can use
digital tools to search a text fragment in a source code or a book, but
there is one more important difference between story and a code - story
is <em>executed</em> in our brains, but code is not. Do we really need
to expose ourselves on all of this source code written as text, on each
line? And even if in some smaller file - do we still need to always see
all of these characters?</p>
<p>This last chapter is not a summary, but is about the idea that
perhaps it would be useful to not display the source code, but relations
between code blocks which belong to the reactive context to minimize the
exposition of developer to the text as far as possible; and using the
fact that code was executed in the machine, not brain, it could be
useful to display the <em>last</em> relation, so the breakpoint can be
set somewhere in the chain relevant for output or side effect. All of
this is of course not new, but because is still a matter of future,
should be reminded in this document.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Grzegorz Smoliński.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
